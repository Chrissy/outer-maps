with pool as
  (select * from trails where source = 'http://www.rco.wa.gov/maps/Data.shtml'),
values as
  (select distinct on (distance) p1.name as name, p1.type as type, p1.geog as geog1, p2.geog as geog2
    ST_Length(ST_ShortestLine(
      ST_Collect(ST_StartPoint(p1.geog::geometry), ST_EndPoint(p1.geog::geometry)),
      ST_Collect(ST_StartPoint(p2.geog::geometry), ST_EndPoint(p2.geog::geometry))
    )) as distance
  from pool p1, pool p2 where p1.name = p2.name and type = type and p1.id != p2.id)
lines as
select name, distance from values where distance < 1;

//

with pool as
  (select * from trails where source = 'http://www.rco.wa.gov/maps/Data.shtml'),
values as
  (select distinct on (line) p1.name as name, p1.type as type, p1.geog as geog1, as geog2, p1.id as id1, p2.id as id2
    ST_ShortestLine(
      ST_Collect(ST_StartPoint(p1.geog::geometry), ST_EndPoint(p1.geog::geometry)),
      ST_Collect(ST_StartPoint(p2.geog::geometry), ST_EndPoint(p2.geog::geometry))
    ) as line
  from pool p1, pool p2 where p1.name = p2.name and type = type and p1.id != p2.id)
lines as
  select name, distance from values where ST_Length(distance) < 1;
